{% extends "base.html" %}
{% block content %}
<a href="{{ url_for('add_item') }}" style="float:right;">+ Add New Item</a>
<h2>Household Inventory</h2>

{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <ul style="list-style:none; padding:0;">
      {% for category, msg in messages %}
        <li style="background:#{% if category == 'error' %}f8d7da{% else %}d4edda{% endif %}; padding:10px; margin:5px 0; border-radius:4px;">
          {{ msg }}
        </li>
      {% endfor %}
    </ul>
  {% endif %}
{% endwith %}

{% if items %}
<table style="width:100%; border-collapse:collapse; margin-top:20px;">
  <thead>
    <tr style="background:#f0f0f0;">
      <th style="text-align:left; padding:10px;">Item</th>
      <th style="width:120px; text-align:center;">Quantity</th>
      <th style="width:300px; text-align:center;">Actions</th>
    </tr>
  </thead>
  <tbody>
    {% for item in items %}
    <tr style="border-bottom:1px solid #ddd;">
      <td style="padding:10px;"><strong>{{ item.name }}</strong></td>
      <td style="text-align:center; font-size:1.2em;">{{ item.quantity }}</td>
      <td style="text-align:center;">
        <!-- Quantity controls -->
        <form method="POST" action="{{ url_for('update_quantity', item_id=item.id) }}" style="display:inline;">
          <button type="submit" name="action" value="increment" style="width:34px; height:34px; font-size:1.2em;">+</button>
          <button type="submit" name="action" value="decrement" style="width:34px; height:34px; font-size:1.2em;"
                  onclick="return {{ item.quantity }}>0 || confirm('Set to zero?') }">-</button>
          <input type="number" name="new_quantity" value="{{ item.quantity }}" min="0" style="width:60px; text-align:center;">
          <button type="submit" name="action" value="set">Update</button>
        </form>
        &nbsp;&nbsp;
        <!-- Edit name -->
        <a href="{{ url_for('edit_item', item_id=item.id) }}" style="text-decoration:none;">
          <button style="background:#0066cc; color:white;">Edit Name</button>
        </a>
        &nbsp;
        <!-- Delete -->
        <form method="POST" action="{{ url_for('delete_item', item_id=item.id) }}" style="display:inline;"
              onsubmit="return confirm('Delete {{ item.name }} forever?')">
          <button type="submit" style="background:#c00; color:white;">Delete</button>
        </form>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% else %}
<p>No items yet. <a href="{{ url_for('add_item') }}">Add the first one!</a></p>
{% endif %}
{% endblock %}